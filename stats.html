<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“Š ç¶²ç«™çµ±è¨ˆ | CHDAY169 æ•™æå¹³å°æ•¸æ“šåˆ†æ</title>
  <link href="assets/style.css" rel="stylesheet">
  <script src="assets/script.js"></script>
  <style>
    .stats-container {
      max-width: 1000px;
      margin: 0 auto;
      padding: var(--space-md);
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--space-lg);
      margin: var(--space-lg) 0;
    }

    .stat-card {
      background: var(--bg-white);
      border-radius: var(--radius-large);
      padding: var(--space-lg);
      box-shadow: var(--shadow-light);
      border: 1px solid var(--border-color);
      text-align: center;
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: bold;
      color: var(--primary-color);
      margin-bottom: var(--space-xs);
    }

    .stat-label {
      color: var(--text-light);
      font-size: 0.9rem;
    }

    .charts-section {
      margin: var(--space-xl) 0;
    }

    .chart-container {
      background: var(--bg-white);
      border-radius: var(--radius-large);
      padding: var(--space-lg);
      box-shadow: var(--shadow-light);
      margin-bottom: var(--space-lg);
    }

    .chart-title {
      color: var(--text-dark);
      margin-bottom: var(--space-md);
      text-align: center;
    }

    .chart {
      height: 300px;
      background: var(--bg-light);
      border-radius: var(--radius-medium);
      display: flex;
      align-items: flex-end;
      justify-content: space-around;
      padding: var(--space-md);
      gap: var(--space-sm);
    }

    .bar {
      background: linear-gradient(to top, var(--primary-color), var(--primary-dark));
      border-radius: var(--radius-small) var(--radius-small) 0 0;
      position: relative;
      flex: 1;
      transition: all 0.3s ease;
      min-width: 40px;
    }

    .bar:hover {
      opacity: 0.8;
      transform: scale(1.05);
    }

    .bar-label {
      position: absolute;
      bottom: -25px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 0.8rem;
      color: var(--text-medium);
    }

    .bar-value {
      position: absolute;
      top: -25px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 0.9rem;
      font-weight: bold;
      color: var(--text-dark);
    }

    .stats-table {
      width: 100%;
      border-collapse: collapse;
      margin: var(--space-lg) 0;
      background: var(--bg-white);
      border-radius: var(--radius-medium);
      overflow: hidden;
      box-shadow: var(--shadow-light);
    }

    .stats-table th,
    .stats-table td {
      padding: var(--space-sm);
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .stats-table th {
      background: var(--primary-light);
      color: var(--text-dark);
      font-weight: 600;
    }

    .stats-table tr:hover {
      background: var(--bg-light);
    }

    .admin-controls {
      background: var(--bg-light);
      border-radius: var(--radius-large);
      padding: var(--space-lg);
      margin: var(--space-xl) 0;
      text-align: center;
    }

    .export-btn {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white;
      border: none;
      padding: var(--space-sm) var(--space-lg);
      border-radius: var(--radius-medium);
      cursor: pointer;
      font-size: 1rem;
      margin: 0 var(--space-xs);
      transition: all 0.3s ease;
    }

    .export-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .reset-btn {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
      border: none;
      padding: var(--space-sm) var(--space-lg);
      border-radius: var(--radius-medium);
      cursor: pointer;
      font-size: 1rem;
      margin: 0 var(--space-xs);
      transition: all 0.3s ease;
    }

    .reset-btn:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .last-updated {
      text-align: center;
      color: var(--text-light);
      font-size: 0.9rem;
      margin-top: var(--space-md);
    }

    .no-data {
      text-align: center;
      padding: var(--space-xl);
      color: var(--text-light);
    }

    @media (max-width: 768px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      
      .chart {
        flex-direction: column;
        height: auto;
        align-items: center;
      }
      
      .bar {
        width: 80%;
        height: 40px;
        margin-bottom: var(--space-lg);
      }
      
      .bar-label {
        bottom: -20px;
      }
      
      .bar-value {
        top: -20px;
      }
    }
  </style>
</head>
<body class="container">
  <header class="page-header">
    <h1>ğŸ“Š ç¶²ç«™çµ±è¨ˆ</h1>
    <p class="subtitle">CHDAY169 æ•™æå¹³å°æ•¸æ“šåˆ†æèˆ‡è¨ªå•çµ±è¨ˆ</p>
  </header>

  <nav class="breadcrumb">
    <a href="index.html">é¦–é </a> &gt; <span>ç¶²ç«™çµ±è¨ˆ</span>
  </nav>

  <main class="stats-container">
    <!-- ç¸½è¦½çµ±è¨ˆ -->
    <section class="overview-section">
      <h2>ğŸ“ˆ ç¸½è¦½çµ±è¨ˆ</h2>
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-number" id="totalVisits">0</div>
          <div class="stat-label">ç¸½è¨ªå•æ¬¡æ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalPages">0</div>
          <div class="stat-label">å·²çµ±è¨ˆé é¢</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="totalLikes">0</div>
          <div class="stat-label">ç¸½é»è®šæ•¸</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="activeDays">0</div>
          <div class="stat-label">æ´»èºå¤©æ•¸</div>
        </div>
      </div>
    </section>

    <!-- é é¢è¨ªå•çµ±è¨ˆ -->
    <section class="charts-section">
      <h2>ğŸŒ é é¢è¨ªå•çµ±è¨ˆ</h2>
      <div class="chart-container">
        <h3 class="chart-title">å„é é¢è¨ªå•é‡æ’å</h3>
        <div class="chart" id="pageViewsChart">
          <!-- å‹•æ…‹ç”ŸæˆæŸ±ç‹€åœ– -->
        </div>
      </div>
    </section>

    <!-- è©³ç´°æ•¸æ“šè¡¨æ ¼ -->
    <section class="table-section">
      <h2>ğŸ“‹ è©³ç´°çµ±è¨ˆæ•¸æ“š</h2>
      <table class="stats-table">
        <thead>
          <tr>
            <th>é é¢åç¨±</th>
            <th>è¨ªå•æ¬¡æ•¸</th>
            <th>é»è®šæ•¸</th>
            <th>æœ€å¾Œè¨ªå•</th>
            <th>æ—¥å‡è¨ªå•</th>
          </tr>
        </thead>
        <tbody id="statsTableBody">
          <!-- å‹•æ…‹ç”Ÿæˆè¡¨æ ¼æ•¸æ“š -->
        </tbody>
      </table>
    </section>

    <!-- æ¯æ—¥è¨ªå•è¶¨å‹¢ -->
    <section class="charts-section">
      <h2>ğŸ“… æ¯æ—¥è¨ªå•è¶¨å‹¢</h2>
      <div class="chart-container">
        <h3 class="chart-title">æœ€è¿‘7å¤©è¨ªå•è¶¨å‹¢</h3>
        <div class="chart" id="dailyTrendsChart">
          <!-- å‹•æ…‹ç”Ÿæˆè¶¨å‹¢åœ– -->
        </div>
      </div>
    </section>

    <!-- ç®¡ç†å“¡æ§åˆ¶ -->
    <section class="admin-controls">
      <h2>âš™ï¸ æ•¸æ“šç®¡ç†</h2>
      <p>ç®¡ç†ç¶²ç«™çµ±è¨ˆæ•¸æ“šèˆ‡åŒ¯å‡ºå ±å‘Š</p>
      <div style="margin: var(--space-md) 0;">
        <button class="export-btn" onclick="exportStats()">ğŸ“¥ åŒ¯å‡ºçµ±è¨ˆæ•¸æ“š</button>
        <button class="reset-btn" onclick="adminLogin()">ğŸ”„ é‡ç½®çµ±è¨ˆæ•¸æ“š</button>
        <button class="export-btn" onclick="refreshStats()">ğŸ”„ é‡æ–°æ•´ç†</button>
      </div>
      <p class="last-updated">æœ€å¾Œæ›´æ–°: <span id="lastUpdated">-</span></p>
    </section>

    <!-- æ•¸æ“šèªªæ˜ -->
    <section class="info-section">
      <div class="info-card">
        <h3>ğŸ’¡ çµ±è¨ˆèªªæ˜</h3>
        <ul>
          <li>æ‰€æœ‰çµ±è¨ˆæ•¸æ“šåŸºæ–¼æœ¬åœ°ç€è¦½å™¨å­˜å„² (localStorage)</li>
          <li>è¨ªå•æ¬¡æ•¸åœ¨æ¯æ¬¡é é¢åŠ è¼‰æ™‚è‡ªå‹•è¨˜éŒ„</li>
          <li>é»è®šæ•¸éœ€è¦ç”¨æˆ¶ä¸»å‹•é»æ“Š"æ¨¡æ“¬é»è®š"æŒ‰éˆ•</li>
          <li>æ•¸æ“šåƒ…åœ¨ç•¶å‰ç€è¦½å™¨ä¸­æœ‰æ•ˆï¼Œæ¸…é™¤ç€è¦½æ•¸æ“šå°‡é‡ç½®çµ±è¨ˆ</li>
        </ul>
      </div>
    </section>
  </main>

  <footer class="page-footer">
    <div class="navigation-buttons">
      <a href="index.html" class="btn btn-primary">â¬…ï¸ å›é¦–é </a>
      <a href="search.html" class="btn btn-secondary">ğŸ” æœå°‹æ–‡ç« </a>
      <a href="comments.html" class="btn btn-outline">ğŸ’¬ ç•™è¨€æ¿</a>
    </div>
    
    <div class="footer-info">
      <p>&copy; 2025 CHDAY169 æ•™æå¹³å° | Created by chday169</p>
    </div>
  </footer>

  <script>
    // çµ±è¨ˆæ•¸æ“šè™•ç†
    document.addEventListener('DOMContentLoaded', function() {
      loadStats();
      updateLastUpdated();
    });

    function loadStats() {
      // è¨ˆç®—ç¸½è¨ªå•æ¬¡æ•¸
      const totalVisits = calculateTotalVisits();
      document.getElementById('totalVisits').textContent = totalVisits.toLocaleString();

      // è¨ˆç®—ç¸½é é¢æ•¸
      const pageCount = Object.keys(localStorage).filter(k => k.startsWith('views_')).length;
      document.getElementById('totalPages').textContent = pageCount;

      // è¨ˆç®—ç¸½é»è®šæ•¸
      const totalLikes = calculateTotalLikes();
      document.getElementById('totalLikes').textContent = totalLikes.toLocaleString();

      // è¨ˆç®—æ´»èºå¤©æ•¸
      const activeDays = calculateActiveDays();
      document.getElementById('activeDays').textContent = activeDays;

      // ç”Ÿæˆé é¢è¨ªå•åœ–è¡¨
      generatePageViewsChart();

      // ç”Ÿæˆè©³ç´°æ•¸æ“šè¡¨æ ¼
      generateStatsTable();

      // ç”Ÿæˆæ¯æ—¥è¶¨å‹¢åœ–
      generateDailyTrendsChart();
    }

    function calculateTotalVisits() {
      const keys = Object.keys(localStorage).filter(k => k.startsWith('views_'));
      return keys.reduce((sum, k) => sum + parseInt(localStorage.getItem(k) || '0'), 0);
    }

    function calculateTotalLikes() {
      const keys = Object.keys(localStorage).filter(k => k.startsWith('likes_'));
      return keys.reduce((sum, k) => sum + parseInt(localStorage.getItem(k) || '0'), 0);
    }

    function calculateActiveDays() {
      const dailyKeys = Object.keys(localStorage).filter(k => k.startsWith('daily_'));
      const dates = new Set();
      dailyKeys.forEach(key => {
        const date = key.split('_')[1]; // daily_YYYY-MM-DD_pageId
        if (date) dates.add(date);
      });
      return dates.size;
    }

    function generatePageViewsChart() {
      const chart = document.getElementById('pageViewsChart');
      chart.innerHTML = '';

      // ç²å–æ‰€æœ‰é é¢è¨ªå•æ•¸æ“š
      const pageData = [];
      Object.keys(localStorage).forEach(key => {
        if (key.startsWith('views_')) {
          const pageId = key.replace('views_', '');
          const views = parseInt(localStorage.getItem(key) || '0');
          const pageName = getPageDisplayName(pageId);
          pageData.push({ name: pageName, views: views, id: pageId });
        }
      });

      // æŒ‰è¨ªå•é‡æ’åºä¸¦å–å‰8å
      pageData.sort((a, b) => b.views - a.views);
      const topPages = pageData.slice(0, 8);

      if (topPages.length === 0) {
        chart.innerHTML = '<div class="no-data">æš«ç„¡è¨ªå•æ•¸æ“š</div>';
        return;
      }

      // è¨ˆç®—æœ€å¤§è¨ªå•é‡ç”¨æ–¼æ¯”ä¾‹è¨ˆç®—
      const maxViews = Math.max(...topPages.map(p => p.views));

      topPages.forEach(page => {
        const barHeight = maxViews > 0 ? (page.views / maxViews) * 80 + 20 : 20;
        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = `${barHeight}%`;
        bar.title = `${page.name}: ${page.views} æ¬¡è¨ªå•`;

        const value = document.createElement('div');
        value.className = 'bar-value';
        value.textContent = page.views;

        const label = document.createElement('div');
        label.className = 'bar-label';
        label.textContent = page.name.length > 8 ? page.name.substring(0, 8) + '...' : page.name;

        bar.appendChild(value);
        bar.appendChild(label);
        chart.appendChild(bar);
      });
    }

    function generateStatsTable() {
      const tableBody = document.getElementById('statsTableBody');
      tableBody.innerHTML = '';

      const pageData = [];
      Object.keys(localStorage).forEach(key => {
        if (key.startsWith('views_')) {
          const pageId = key.replace('views_', '');
          const views = parseInt(localStorage.getItem(key) || '0');
          const likes = parseInt(localStorage.getItem(`likes_${pageId}`) || '0');
          const pageName = getPageDisplayName(pageId);
          
          // è¨ˆç®—æ—¥å‡è¨ªå•ï¼ˆç°¡å–®ä¼°ç®—ï¼‰
          const dailyAvg = Math.round(views / 30); // å‡è¨­30å¤©

          pageData.push({
            name: pageName,
            views: views,
            likes: likes,
            dailyAvg: dailyAvg,
            lastVisit: getLastVisit(pageId)
          });
        }
      });

      // æŒ‰è¨ªå•é‡æ’åº
      pageData.sort((a, b) => b.views - a.views);

      if (pageData.length === 0) {
        tableBody.innerHTML = '<tr><td colspan="5" class="no-data">æš«ç„¡çµ±è¨ˆæ•¸æ“š</td></tr>';
        return;
      }

      pageData.forEach(page => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${page.name}</td>
          <td>${page.views.toLocaleString()}</td>
          <td>${page.likes.toLocaleString()}</td>
          <td>${page.lastVisit}</td>
          <td>${page.dailyAvg.toLocaleString()}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    function generateDailyTrendsChart() {
      const chart = document.getElementById('dailyTrendsChart');
      chart.innerHTML = '';

      // ç²å–æœ€è¿‘7å¤©çš„æ•¸æ“š
      const last7Days = getLast7Days();
      const dailyData = last7Days.map(day => {
        const dayViews = Object.keys(localStorage)
          .filter(key => key.includes(day))
          .reduce((sum, key) => sum + parseInt(localStorage.getItem(key) || '0'), 0);
        return { date: day, views: dayViews };
      });

      const maxViews = Math.max(...dailyData.map(d => d.views), 1);

      dailyData.forEach(day => {
        const barHeight = (day.views / maxViews) * 80 + 20;
        const bar = document.createElement('div');
        bar.className = 'bar';
        bar.style.height = `${barHeight}%`;
        bar.title = `${day.date}: ${day.views} æ¬¡è¨ªå•`;

        const value = document.createElement('div');
        value.className = 'bar-value';
        value.textContent = day.views;

        const label = document.createElement('div');
        label.className = 'bar-label';
        label.textContent = day.date.split('-').slice(1).join('/'); // é¡¯ç¤º MM/DD

        bar.appendChild(value);
        bar.appendChild(label);
        chart.appendChild(bar);
      });
    }

    function getPageDisplayName(pageId) {
      const pageNames = {
        'v1a_home': 'é¦–é ',
        'about_me': 'é—œæ–¼ä½œè€…',
        'comments': 'ç•™è¨€æ¿',
        'stats': 'ç¶²ç«™çµ±è¨ˆ',
        'search': 'æœå°‹é é¢',
        'resources': 'æ¨è–¦è³‡æº',
        'publications': 'æˆ‘çš„å‡ºç‰ˆå“',
        'viewer_scr': 'Scratch æ•™æ',
        'viewer_geo': 'åœ°è³ªæ•™æ',
        'youtube-videos': 'æ•™å­¸å½±ç‰‡',  // ä¿®æ”¹é€™è£¡
        'monthly_oct2025': '10æœˆåœ°è³ªä¸»é¡Œ'
      };
      return pageNames[pageId] || pageId;
    }

    function getLastVisit(pageId) {
      // é€™è£¡å¯ä»¥å¯¦ç¾æ›´è¤‡é›œçš„æœ€å¾Œè¨ªå•æ™‚é–“è·Ÿè¸ª
      return 'ä»Šæ—¥';
    }

    function getLast7Days() {
      const days = [];
      for (let i = 6; i >= 0; i--) {
        const date = new Date();
        date.setDate(date.getDate() - i);
        days.push(date.toISOString().slice(0, 10));
      }
      return days;
    }

    function updateLastUpdated() {
      const now = new Date();
      document.getElementById('lastUpdated').textContent = now.toLocaleString('zh-TW');
    }

    function refreshStats() {
      loadStats();
      updateLastUpdated();
      alert('çµ±è¨ˆæ•¸æ“šå·²æ›´æ–°ï¼');
    }

    // ä½¿ç”¨ script.js ä¸­çš„å‡½æ•¸
    function exportStats() {
      if (typeof window.exportStats === 'function') {
        window.exportStats();
      } else {
        alert('åŒ¯å‡ºåŠŸèƒ½æš«ä¸å¯ç”¨');
      }
    }

    function adminLogin() {
      if (typeof window.adminLogin === 'function') {
        window.adminLogin();
      } else {
        alert('ç®¡ç†åŠŸèƒ½æš«ä¸å¯ç”¨');
      }
    }
  </script>
</body>
</html>